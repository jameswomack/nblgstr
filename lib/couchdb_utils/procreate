#!/usr/bin/env coffee

[cs,file,dbname,home] =  process.argv

class Procreate
  request = require 'request'
  authority = require './authority'
  terminal = require 'node-terminal'
  terminate = require '../terminal/terminate'

  constructor: (@dbname,@home = "http://localhost:5984") ->
    request_options =
      uri: "#{@home}/#{@dbname}"
      json: true
      method: 'PUT'

    if authority.u? and authority.p?
      request_options.headers = authority.h

    request request_options
    , (error, response, body) =>
      terminate.foreplay()

      terminate.albinize "Response from CouchDB:"

      terminate.moreplay()

      if body['reason']?
        terminate.puto body
      else if body['ok']?
        terminate.putp "Procreate successfully created database", @dbname


p = new Procreate(dbname,home)